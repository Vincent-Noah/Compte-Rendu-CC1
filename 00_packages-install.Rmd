---
title: "metabarcoding with dada2: environment installation"
output: html_notebook
---
# Mettre à jour la configuration de la machine virtuelle.

``` {bash}
sudo apt-get update -y 
sudo apt-get install -y libbz2-dev
sudo apt-get install -y liblzma-dev
```

#Installation des DADA2 et de Phyloseq.

A partir des instructions https://benjjneb.github.io/dada2/dada-installation.html

##Installation de DADA2 via BiocManager

```{r package install}
if (!requireNamespace("BiocManager", quietly = TRUE))
  install.packages("BiocManager")
BiocManager::install(version = '3.11')
BiocManager::install("dada2", version = "3.11")
```

## Installation de Phyloseq

```{r}
BiocManager::install("phyloseq", version = "3.11")
```




#Installation de packages pour phyloseq.

##Installation de phangorn.

```{r}
BiocManager::install("phangorn")
```


##Installation de DECIPHER.

```{r}
BiocManager::install("DECIPHER")
```


##Installation de gridExtra

```{r}
install.packages("gridExtra")
```



#Exemple de construction de data.frame à partir d'informations encodées dans les noms de fichiers.

```{r}
samples.out <- rownames(seqtab.nochim)
subject <- sapply(strsplit(samples.out, "D"), `[`, 1)
gender <- substr(subject,1,1)
subject <- substr(subject,2,999)
day <- as.integer(sapply(strsplit(samples.out, "D"), `[`, 2))
samdf <- data.frame(Subject=subject, Gender=gender, Day=day)
samdf$When <- "Early"
samdf$When[samdf$Day>100] <- "Late"
rownames(samdf) <- samples.out
```


#Construction de l'arbre à partir des données de dada2 (phyloseq)

```{r}
library(phangorn)
library(DECIPHER)
library(dada2)
seqs <- getSequences(seqtab.nochim)
names(seqs) <- seqs # This propagates to the tip labels of the tree
alignment <- AlignSeqs(DNAStringSet(seqs), anchor=NA,verbose=FALSE)
phangAlign <- phyDat(as(alignment, "matrix"), type="DNA")
dm <- dist.ml(phangAlign)
treeNJ <- NJ(dm) # Note, tip order != sequence order
fit = pml(treeNJ, data=phangAlign)
fitGTR <- update(fit, k=4, inv=0.2)
fitGTR <- optim.pml(fitGTR, model="GTR", optInv=TRUE, optGamma=TRUE,
        rearrangement = "stochastic", control = pml.control(trace = 0))
detach("package:phangorn", unload=TRUE)
```



#Installation de packages pour des analyses complémentaires sur phyloseq.


```{r}
.cran_packages <- c( "shiny","miniUI", "caret", "pls", "e1071", "ggplot2", "randomForest", "dplyr", "ggrepel", "nlme", "devtools",
                  "reshape2", "PMA", "structSSI", "ade4",
                  "ggnetwork", "intergraph", "scales")
.github_packages <- c("jfukuyama/phyloseqGraphTest")
.bioc_packages <- c("genefilter", "impute")
```

```{r}
install.packages(.cran_packages)
devtools::install_github(.github_packages)
BiocManager::install(.bioc_packages)                         
```





